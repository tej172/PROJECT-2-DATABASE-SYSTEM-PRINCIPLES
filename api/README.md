<h1 align="center">API</h1>

This is the backend of our SQL query optimization visualizer.

## Installation and setup

1. Ensure that you have [Poetry](https://python-poetry.org/docs/) (A package manager for Python) and at minimum [Python 3.8](https://www.python.org/downloads/) installed. You can run `pip install poetry` in your environment to install Poetry.
2. `cd` into this folder and run `poetry install` to install the Python package dependencies for this backend. We are using Flask as a web server.
3. By default, the API server starts in production mode. To run in development mode and enable hot reloading, create an `.env` file in this folder and add the following environment variables:

```bash
FLASK_APP=app.py
FLASK_ENV=development
```

4. You will have to connect to a Postgresql database to run the query. This database should be populated with dummy data generated by [TPC-H](http://www.tpc.org/tpch/). See the [main README](https://github.com/chenningg/sql-query-optimizer) if you have not generated the TPC-H dataset.
5. There are two ways to connect to the database. The first way is to input your database details directly in the frontend client itself, but the state will only persist until the page is refreshed. If you do not want to type in your details every time, fill up the `.env` file with the connection details of your PostgreSQL database. You `api/.env` file should look something like this now

```bash
FLASK_APP=app.py
FLASK_ENV=development
DB_HOST=localhost     (The IP your database is hosted on)
DB_NAME=TPC-H         (The name of your database)
DB_USER=postgres      (The username of the user that owns the database)
DB_PASSWORD=postgres  (Password for your user)
DB_PORT=5432          (Port that your database runs on)
```

We recommend that you use this exact configuration for the PostgreSQL database (aka with a database named "TPC-H").

6. To start the API server, you can run `poetry run flask run` from this folder, or head back up to the `root` folder and run `yarn start`, which starts both the frontend client and the API server concurrently.
